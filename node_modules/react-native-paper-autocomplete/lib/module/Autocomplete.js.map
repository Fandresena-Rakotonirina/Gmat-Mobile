{"version":3,"sources":["Autocomplete.tsx"],"names":["React","View","StyleSheet","TextInput","NativeTextInput","FlatList","SectionList","ActivityIndicator","Chip","IconButton","List","useTheme","Color","useLatest","useAutomaticScroller","AutocompleteItem","useHighlighted","PortalContent","useComponentDimensions","PositionedSurface","Animated","useAnimatedRef","useAnimatedStyle","useDerivedValue","useAutocomplete","getFlatListItemLayout","_","index","length","offset","defaultFilterOptions","a","isFocusedAndValueIsSameAsSearch","inputValue","getOptionLabel","getOptionDescription","filter","o","oAny","search","toLowerCase","label","description","includes","removeSelected","value","rValue","multiple","getOptionValue","selected","some","v","Autocomplete","props","theme","scrollableRef","scrollX","scrollY","testID","loading","ListComponent","inputProps","onChangeText","defaultValue","listProps","groupBy","options","style","option","id","key","name","title","getOptionIcon","icon","filterOptions","b","values","onChange","onChangeMultiple","singleValue","onChangeSingle","inputContainerDimensions","chipsDimensions","chipContainerRef","inputContainerRef","inputRef","useRef","setInputValue","useState","visible","setVisible","focused","setFocused","getOptionLabelRef","useEffect","current","changeText","blur","focus","filterOptionsRef","groupByRef","getOptionValueRef","getOptionDescriptionRef","data","useMemo","highlightedIndex","handleKeyPress","sections","grouped","forEach","push","Object","keys","map","k","press","useCallback","remove","excludeCurrent","vo","automaticScrollProps","minimalDropdownWidth","dropdownWidth","width","remainingSpace","shouldEnter","height","hasMultipleValue","highlightedColor","dark","colors","onBackground","alpha","rgb","string","innerListProps","keyboardDismissMode","keyboardShouldPersistTaps","contentInsetAdjustmentBehavior","renderItem","item","section","realIndex","sectionIndex","indexOf","indexesBefore","i","reduce","keyExtractor","extraData","SectionListComponent","FinalListComponent","inputStyle","backgroundColor","flattenStyle","flatten","background","onPressOutside","textInputIcon","undefined","styles","menu","onLayout","inputContainer","disableInputPrefixIcon","full","params","closeButton","arrowIconButton","chipsWrapper","chip","info","console","error","AnimatedNativeInput","createAnimatedComponent","NativeTextInputWithAnimatedStyles","forwardRef","chipsHeight","chipsWidth","rest","forwardedRef","originalStyle","orgTop","Number","paddingTop","orgLeft","paddingLeft","animatedStyle","addTop","create","modalBackground","flex","position","flexDirection","flexWrap","top","left","marginRight","marginBottom","flexShrink","alignItems","bottom","right"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport {\n  TextInputProps,\n  View,\n  ViewStyle,\n  StyleSheet,\n  TextInput as NativeTextInput,\n  TextInputFocusEventData,\n  NativeSyntheticEvent,\n  FlatList,\n  SectionList,\n  // useWindowDimensions,\n  FlatListProps,\n} from 'react-native';\nimport {\n  ActivityIndicator,\n  Chip,\n  IconButton,\n  List,\n  TextInput,\n  useTheme,\n} from 'react-native-paper';\nimport Color from 'color';\n\nimport useLatest from './useLatest';\nimport useAutomaticScroller from './useAutomaticScroller';\nimport AutocompleteItem from './AutocompleteItem';\nimport type { IconSource } from './icon';\nimport useHighlighted from './useHighlighted';\nimport PortalContent from './PortalContent';\nimport useComponentDimensions from './useComponentDimensions';\nimport PositionedSurface from './PositionedSurface';\nimport Animated, {\n  DerivedValue,\n  SharedValue,\n  useAnimatedRef,\n  useAnimatedStyle,\n  useDerivedValue,\n} from 'react-native-reanimated';\nimport { useAutocomplete } from './AutocompleteContext';\n\n// https://ej2.syncfusion.com/react/documentation/drop-down-list/accessibility/\n\ntype PaperInputProps = React.ComponentProps<typeof TextInput>;\n\nexport function getFlatListItemLayout(\n  _: any[] | undefined | null,\n  index: number\n) {\n  return {\n    length: 63,\n    offset: 63 * index,\n    index,\n  };\n}\n\n// const AnimatedTextInput = createElement(TextInput);\nexport interface FilterOptionsParams<ItemT> {\n  isFocusedAndValueIsSameAsSearch: boolean;\n  inputValue: string;\n  getOptionLabel: (option: ItemT) => string;\n  getOptionDescription?: (option: ItemT) => string;\n}\n\nexport interface AutocompleteBaseProps<ItemT> {\n  testID?: string;\n  loading?: boolean;\n  listProps?: Omit<\n    FlatListProps<ItemT>,\n    'data' | 'renderItem' | 'ref' | 'keyExtractor' | 'extraData'\n  >;\n  inputProps?: PaperInputProps;\n  ListComponent?: any;\n  options: ReadonlyArray<ItemT> | null | undefined;\n  groupBy?: (option: ItemT) => string;\n  renderInput?: (params: TextInputProps) => any;\n  style?: ViewStyle;\n  disableInputPrefixIcon?: boolean;\n  getOptionLabel?: (option: ItemT) => string;\n  getOptionDescription?: (option: ItemT) => string | number;\n  getOptionValue?: (option: ItemT) => string | number;\n  getOptionIcon?: (option: ItemT) => IconSource;\n  filterOptions?: (\n    a: ReadonlyArray<ItemT> | null | undefined,\n    {\n      isFocusedAndValueIsSameAsSearch,\n      inputValue,\n      getOptionLabel,\n      getOptionDescription,\n    }: FilterOptionsParams<ItemT>\n  ) => ReadonlyArray<ItemT> | null | undefined;\n}\n\nexport interface AutocompleteMultipleProps<ItemT>\n  extends AutocompleteBaseProps<ItemT> {\n  multiple: true;\n  value: ItemT[] | null | undefined;\n  onChange: (v: ItemT[]) => void;\n}\n\nexport interface AutocompleteSingleProps<ItemT>\n  extends AutocompleteBaseProps<ItemT> {\n  multiple?: undefined | false;\n  value: ItemT | null | undefined;\n  onChange: (v: ItemT | undefined) => void;\n}\n\nexport function defaultFilterOptions<ItemT>(\n  a: ReadonlyArray<ItemT> | null | undefined,\n  {\n    isFocusedAndValueIsSameAsSearch,\n    inputValue,\n    getOptionLabel,\n    getOptionDescription,\n  }: FilterOptionsParams<ItemT>\n) {\n  if (isFocusedAndValueIsSameAsSearch) {\n    return a;\n  }\n  return a?.filter((o) => {\n    const oAny = o as any;\n    if (!inputValue) {\n      return true;\n    }\n    const search = inputValue.toLowerCase();\n    const label = getOptionLabel(oAny) || '';\n    const description = getOptionDescription?.(oAny) || '';\n    return (\n      label.toLowerCase().includes(search) ||\n      description.toLowerCase().includes(search)\n    );\n  });\n}\n\nfunction removeSelected<ItemT>(\n  a: ReadonlyArray<ItemT> | null | undefined,\n  {\n    value: rValue,\n    multiple,\n    getOptionValue,\n  }: {\n    value: ItemT | ItemT[] | null | undefined;\n    multiple: boolean | undefined;\n    getOptionValue: (option: ItemT) => string | number;\n  }\n) {\n  return a?.filter((o) => {\n    let selected = multiple\n      ? (rValue as ItemT[])?.some(\n          (v) => getOptionValue(v) === getOptionValue(o)\n        )\n      : rValue && getOptionValue(rValue as ItemT) === getOptionValue(o);\n\n    return !selected;\n  });\n}\n\nexport default function Autocomplete<ItemT>(\n  props: AutocompleteMultipleProps<ItemT> | AutocompleteSingleProps<ItemT>\n) {\n  // const window = useWindowDimensions();\n  const theme = useTheme();\n  const { scrollableRef, scrollX, scrollY } = useAutocomplete();\n  const {\n    testID,\n    loading,\n    ListComponent,\n    inputProps: { onChangeText, defaultValue, ...inputProps } = {},\n    listProps,\n    groupBy,\n    multiple,\n    options,\n    style,\n    value,\n    getOptionValue = (option: ItemT) =>\n      (option as any).id || (option as any).key || (option as any).value,\n    getOptionLabel = (option: ItemT) =>\n      (option as any).label || (option as any).name || (option as any).title,\n    getOptionDescription = (option: ItemT) => (option as any).description,\n    getOptionIcon = (option: ItemT) => (option as any).icon,\n    filterOptions = (a, b) => defaultFilterOptions<ItemT>(a, b),\n  } = props;\n  const { value: values, onChange: onChangeMultiple } =\n    props as AutocompleteMultipleProps<ItemT>;\n  const { value: singleValue, onChange: onChangeSingle } =\n    props as AutocompleteSingleProps<ItemT>;\n\n  const inputContainerDimensions = useComponentDimensions();\n  const chipsDimensions = useComponentDimensions();\n\n  const chipContainerRef = useAnimatedRef<Animated.View>();\n  const inputContainerRef = useAnimatedRef<Animated.View>();\n  const inputRef = React.useRef<NativeTextInput>(null);\n  const [inputValue, setInputValue] = React.useState(defaultValue || '');\n  const [visible, setVisible] = React.useState(false);\n  const [focused, setFocused] = React.useState(false);\n\n  const getOptionLabelRef = useLatest(getOptionLabel);\n  React.useEffect(() => {\n    if (!multiple) {\n      if (singleValue) {\n        setInputValue(getOptionLabelRef.current(singleValue));\n      } else {\n        setInputValue('');\n      }\n    }\n  }, [getOptionLabelRef, multiple, singleValue]);\n\n  const changeText = (v: string) => {\n    // setVisible(true);\n    setInputValue(v);\n    onChangeText?.(v);\n  };\n  const blur = (_: NativeSyntheticEvent<TextInputFocusEventData>) => {\n    // console.log('blur', e);\n    // setVisible(false);\n    setFocused(false);\n  };\n  const focus = (_: NativeSyntheticEvent<TextInputFocusEventData>) => {\n    setVisible(true);\n    setFocused(true);\n  };\n\n  const filterOptionsRef = useLatest(filterOptions);\n  const groupByRef = useLatest(groupBy);\n  const getOptionValueRef = useLatest(getOptionValue);\n  const getOptionDescriptionRef = useLatest(getOptionDescription);\n\n  const isFocusedAndValueIsSameAsSearch =\n    (singleValue && focused && inputValue === getOptionLabel(singleValue)) ||\n    false;\n\n  // console.log({\n  //   singleValue,\n  //   focused,\n  //   inputValue,\n  //   inputValueCompareTo: singleValue && getOptionLabel(singleValue),\n  //   isFocusedAndValueIsSameAsSearch,\n  // });\n\n  const data = React.useMemo(\n    () =>\n      filterOptionsRef.current(\n        removeSelected(options, {\n          value,\n          multiple,\n          getOptionValue: getOptionValueRef.current,\n        }),\n        {\n          isFocusedAndValueIsSameAsSearch,\n          getOptionLabel: getOptionLabelRef.current,\n          getOptionDescription: getOptionDescriptionRef.current,\n          inputValue,\n        }\n      ),\n    [\n      isFocusedAndValueIsSameAsSearch,\n      filterOptionsRef,\n      inputValue,\n      value,\n      multiple,\n      options,\n      getOptionValueRef,\n      getOptionLabelRef,\n      getOptionDescriptionRef,\n    ]\n  );\n\n  const { highlightedIndex, handleKeyPress } = useHighlighted({\n    inputValue,\n    setInputValue,\n    data,\n    multiple,\n    values,\n    onChangeMultiple,\n    onChangeSingle,\n    inputRef,\n    setVisible,\n  });\n\n  const sections = React.useMemo(() => {\n    if (!groupByRef || !groupByRef.current) {\n      return [];\n    }\n    let grouped: { [key: string]: ItemT[] } = {};\n    data?.forEach((o) => {\n      const key = groupByRef.current!(o);\n      const current = grouped[key];\n      if (current) {\n        current.push(o);\n      } else {\n        grouped[key] = [o];\n      }\n    });\n\n    return Object.keys(grouped).map((k) => ({\n      title: k,\n      data: grouped[k],\n    }));\n  }, [data, groupByRef]);\n\n  const press = React.useCallback(\n    (o: ItemT) => {\n      if (multiple) {\n        inputRef.current?.focus();\n        onChangeMultiple([...(values || []), o]);\n        setInputValue('');\n      } else {\n        onChangeSingle(o);\n        setVisible(false);\n      }\n    },\n    [multiple, setInputValue, onChangeMultiple, onChangeSingle, values]\n  );\n\n  const remove = React.useCallback(\n    (o: ItemT) => {\n      if (multiple) {\n        const excludeCurrent = (values || []).filter(\n          (vo) => getOptionValueRef.current(vo) !== getOptionValueRef.current(o)\n        );\n        onChangeMultiple(excludeCurrent);\n      }\n    },\n    [getOptionValueRef, multiple, onChangeMultiple, values]\n  );\n\n  const automaticScrollProps = useAutomaticScroller({\n    highlightedIndex,\n    sections,\n    groupBy,\n  });\n\n  const minimalDropdownWidth = 250;\n  const dropdownWidth = inputContainerDimensions.width;\n  const remainingSpace = useDerivedValue(\n    () => inputContainerDimensions.width.value - chipsDimensions.width.value,\n    [inputContainerDimensions.width, chipsDimensions.width]\n  );\n\n  const shouldEnter = useDerivedValue(\n    () =>\n      chipsDimensions.height.value > 45 ||\n      remainingSpace.value < minimalDropdownWidth,\n    [chipsDimensions.height, remainingSpace]\n  );\n  const hasMultipleValue = multiple && (values || []).length > 0;\n\n  // const animatedInputStyle = useAnimatedStyle(() => {\n  //   return {\n  //     height: hasMultipleValue\n  //       ? shouldEnter\n  //         ? chipsDimensions.height.value + 36 + 46\n  //         : chipsDimensions.height.value + 36\n  //       : undefined,\n  //   };\n  // }, [chipsDimensions.height, hasMultipleValue, shouldEnter]);\n  const highlightedColor = React.useMemo(\n    () =>\n      theme.dark\n        ? Color(theme.colors.onBackground).alpha(0.2).rgb().string()\n        : Color(theme.colors.onBackground).alpha(0.1).rgb().string(),\n    [theme.dark, theme.colors.onBackground]\n  );\n\n  const innerListProps = {\n    testID: `${testID}-autocomplete-list`,\n    keyboardDismissMode: 'on-drag',\n    keyboardShouldPersistTaps: 'handled',\n    contentInsetAdjustmentBehavior: 'always',\n    renderItem: ({\n      item,\n      index,\n      section,\n    }: {\n      item: ItemT;\n      index: number;\n      section?: any;\n    }) => {\n      const key = getOptionValue(item);\n      let realIndex = index;\n      if (section) {\n        // what the hell...\n        const sectionIndex = sections.indexOf(section);\n        const indexesBefore = sections\n          .filter((_, i) => i < sectionIndex)\n          .reduce((a, b) => a + b.data.length, 0);\n        realIndex = indexesBefore + index;\n      }\n      return (\n        <AutocompleteItem<ItemT>\n          testID={`${testID}-autocomplete-item-${key}`}\n          key={key}\n          highlightedColor={highlightedColor}\n          title={getOptionLabel(item)}\n          description={getOptionDescription(item)}\n          icon={getOptionIcon(item)}\n          selected={highlightedIndex === realIndex}\n          onPress={press}\n          option={item}\n        />\n      );\n    },\n    keyExtractor: (item: ItemT) => getOptionValue(item),\n    extraData: { highlightedIndex },\n    ...automaticScrollProps,\n  };\n\n  const SectionListComponent = ListComponent ? ListComponent : SectionList;\n  const FinalListComponent = ListComponent ? ListComponent : FlatList;\n\n  const inputStyle = (inputProps as any)?.style;\n  const backgroundColor = React.useMemo(() => {\n    if (inputStyle) {\n      const flattenStyle = StyleSheet.flatten(inputStyle);\n      if (flattenStyle.backgroundColor) {\n        return flattenStyle.backgroundColor;\n      }\n    }\n    return theme.colors.background;\n  }, [theme, inputStyle]);\n  const onPressOutside = React.useCallback(() => {\n    setVisible(false);\n  }, [setVisible]);\n\n  // console.log({\n  //   visible,\n  //   inputDim: inputContainerDimensions.dimensions,\n  //   chipsDimensions,\n  //   shouldEnter,\n  // });\n\n  const textInputIcon = singleValue ? getOptionIcon(singleValue) : undefined;\n  return (\n    <View style={[styles.menu, style]} accessibilityRole=\"menu\" testID={testID}>\n      <Animated.View\n        ref={inputContainerRef}\n        onLayout={inputContainerDimensions.onLayout}\n        style={styles.inputContainer}\n      >\n        <TextInput\n          ref={inputRef}\n          onBlur={blur}\n          onFocus={focus}\n          blurOnSubmit={false}\n          value={hasMultipleValue || inputValue.length > 0 ? ' ' : ''}\n          left={\n            textInputIcon && !props.disableInputPrefixIcon ? (\n              <TextInput.Icon icon={textInputIcon} />\n            ) : undefined\n          }\n          {...inputProps}\n          style={[inputProps.style, styles.full]}\n          // @ts-ignore web only props\n          accessibilityHasPopup={true}\n          render={(params) => {\n            return (\n              <NativeTextInputWithAnimatedStyles\n                {...params}\n                selectTextOnFocus={true}\n                value={inputValue}\n                onChangeText={changeText}\n                onKeyPress={handleKeyPress}\n                shouldEnter={shouldEnter}\n                chipsHeight={chipsDimensions.height}\n                chipsWidth={chipsDimensions.width}\n                multiple={multiple}\n              />\n            );\n          }}\n        />\n        {(multiple && visible) || (!multiple && value) ? (\n          <IconButton\n            testID=\"autocomplete-close\"\n            size={20}\n            icon=\"close\"\n            style={styles.closeButton}\n            onPress={() => {\n              setVisible(false);\n              setInputValue('');\n              if (multiple) {\n                onChangeMultiple([]);\n              } else {\n                onChangeSingle(undefined);\n              }\n            }}\n          />\n        ) : null}\n        <IconButton\n          testID={`${testID}-autocomplete-arrow`}\n          style={styles.arrowIconButton}\n          icon={visible ? 'menu-up' : 'menu-down'}\n          onPress={() => {\n            if (visible) {\n              inputRef.current?.blur();\n              setVisible(false);\n            } else {\n              inputRef.current?.focus();\n              setVisible(true);\n            }\n          }}\n        />\n      </Animated.View>\n      {multiple && (\n        <Animated.View\n          ref={chipContainerRef}\n          testID={`${testID}-autocomplete-chips`}\n          style={[styles.chipsWrapper, { backgroundColor }]}\n          onLayout={chipsDimensions.onLayout}\n          pointerEvents=\"box-none\"\n        >\n          {values?.map((o) => (\n            <Chip\n              key={getOptionValue(o)}\n              onClose={() => remove(o)}\n              style={styles.chip}\n              icon={getOptionIcon(o)}\n            >\n              {getOptionLabel(o)}\n            </Chip>\n          ))}\n        </Animated.View>\n      )}\n      {loading ? <ActivityIndicator style={styles.loading} /> : null}\n      {visible ? (\n        <PortalContent visible={visible} onPressOutside={onPressOutside}>\n          <PositionedSurface\n            scrollableRef={scrollableRef}\n            theme={theme}\n            dropdownWidth={dropdownWidth}\n            inputContainerRef={inputContainerRef}\n            inputContainerHeight={inputContainerDimensions.height}\n            scrollX={scrollX}\n            scrollY={scrollY}\n          >\n            {groupBy ? (\n              <SectionListComponent<ItemT>\n                {...listProps}\n                {...innerListProps}\n                sections={sections}\n                renderSectionHeader={({ section: { title } }: any) => (\n                  <List.Subheader>{title}</List.Subheader>\n                )}\n                onScrollToIndexFailed={(info: any) => {\n                  // TODO: make sure everything uses fixed heights so this error won't be there\n                  // e.g.:  getItemLayout={getSectionListItemLayout}\n                  console.error(info);\n                }}\n              />\n            ) : (\n              <FinalListComponent<ItemT>\n                {...listProps}\n                {...innerListProps}\n                getItemLayout={getFlatListItemLayout}\n                data={data}\n              />\n            )}\n          </PositionedSurface>\n        </PortalContent>\n      ) : null}\n    </View>\n  );\n}\n\nconst AnimatedNativeInput = Animated.createAnimatedComponent(NativeTextInput);\nconst NativeTextInputWithAnimatedStyles = React.forwardRef(\n  (\n    {\n      shouldEnter,\n      chipsHeight,\n      chipsWidth,\n      style,\n      multiple,\n      ...rest\n    }: TextInputProps & {\n      multiple: boolean | undefined;\n      shouldEnter: DerivedValue<boolean>;\n      chipsHeight: SharedValue<number>;\n      chipsWidth: SharedValue<number>;\n    },\n    forwardedRef: any\n  ) => {\n    const originalStyle = StyleSheet.flatten(style);\n\n    const orgTop = Number(originalStyle.paddingTop) || 0;\n    const orgLeft = Number(originalStyle.paddingLeft) || 0;\n    const height = Number(originalStyle.height) || 0;\n    const animatedStyle = useAnimatedStyle(() => {\n      if (!multiple) {\n        return {};\n      }\n      const addTop = shouldEnter.value ? chipsHeight.value + 18 : 18;\n\n      return {\n        paddingTop: orgTop + addTop,\n        paddingLeft: orgLeft + (shouldEnter.value ? 0 : chipsWidth.value),\n        height: height + addTop,\n      };\n    }, [multiple, orgLeft, orgTop, shouldEnter, chipsHeight, chipsWidth]);\n\n    return (\n      <AnimatedNativeInput\n        ref={forwardedRef}\n        {...rest}\n        style={[style, animatedStyle]}\n      />\n    );\n  }\n);\n\nconst styles = StyleSheet.create({\n  modalBackground: {\n    flex: 1,\n  },\n  menu: {\n    position: 'relative',\n  },\n  chipsWrapper: {\n    flexDirection: 'row',\n    position: 'absolute',\n    flexWrap: 'wrap',\n    top: 32,\n    left: 12,\n  },\n  chip: { marginRight: 6, marginBottom: 6, flexShrink: 1 },\n\n  inputContainer: { alignItems: 'center', flexDirection: 'row' },\n  full: { flex: 1 },\n  closeButton: {\n    position: 'absolute',\n    bottom: 6,\n    right: 36,\n  },\n  arrowIconButton: {\n    position: 'absolute',\n    bottom: 5,\n    right: 0,\n  },\n  loading: { position: 'absolute', right: 12, top: 24 },\n});\n"]}