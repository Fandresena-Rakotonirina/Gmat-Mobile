{"version":3,"sources":["useAutomaticScroller.ts"],"names":["React","useLatest","useAutomaticScroller","highlightedIndex","sections","groupBy","viewableItems","useRef","isSectionList","flatListRef","sectionListRef","sectionsRef","onViewableItemsChanged","useCallback","p","current","useEffect","viewAbleIndexes","map","index","section","sectionIndex","indexOf","indexesBefore","filter","_","i","reduce","a","b","data","length","undefined","realIndex","n","isViewable","vi","includes","scrollParams","findSectionScrollParams","scrollToLocation","scrollToIndex","animated","ref","itemIndex"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport type { FlatList, SectionList } from 'react-native';\nimport useLatest from './useLatest';\n\nexport default function useAutomaticScroller<ItemT>({\n  highlightedIndex,\n  sections,\n  groupBy,\n}: {\n  highlightedIndex: number;\n  sections: { title: string; data: ItemT[] }[];\n  groupBy?: (option: ItemT) => string;\n}) {\n  const viewableItems = React.useRef<any[]>([]);\n  const isSectionList = !!groupBy;\n  const flatListRef = React.useRef<FlatList>(null);\n  const sectionListRef = React.useRef<SectionList>(null);\n  const sectionsRef = useLatest(sections);\n\n  const onViewableItemsChanged = React.useCallback(\n    (p: any) => {\n      viewableItems.current = p.viewableItems;\n    },\n    [viewableItems]\n  );\n\n  React.useEffect(() => {\n    if (isSectionList) {\n      const viewAbleIndexes = viewableItems.current\n        .map(({ index, section }) => {\n          const sectionIndex = sectionsRef.current.indexOf(section);\n          const indexesBefore = sectionsRef.current\n            .filter((_, i) => i < sectionIndex)\n            .reduce((a, b) => a + b.data.length, 0);\n          if (index === null || index === undefined) {\n            return null;\n          }\n          return {\n            sectionIndex: sectionsRef.current.indexOf(section),\n            index: index,\n            realIndex: indexesBefore + (index || 0),\n          };\n        })\n        .filter((n) => n);\n      const isViewable = viewAbleIndexes\n        .map((vi) => vi!.index)\n        .includes(highlightedIndex);\n\n      if (!isViewable) {\n        const scrollParams = findSectionScrollParams({\n          sections: sectionsRef.current,\n          highlightedIndex,\n        });\n\n        sectionListRef.current?.scrollToLocation(scrollParams);\n      }\n    } else {\n      const isViewable = viewableItems.current\n        .map((vi) => vi.index)\n        .includes(highlightedIndex);\n      if (isViewable) {\n        return;\n      }\n      flatListRef.current?.scrollToIndex({\n        index: highlightedIndex,\n        animated: false,\n      });\n    }\n  }, [highlightedIndex, sectionsRef, flatListRef, isSectionList]);\n\n  return {\n    onViewableItemsChanged,\n    ref: (isSectionList ? sectionListRef : flatListRef) as any,\n  };\n}\n\nfunction findSectionScrollParams({\n  sections,\n  highlightedIndex,\n}: {\n  sections: any[];\n  highlightedIndex: number;\n}) {\n  let i = 0;\n  for (let sectionIndex = 0; sectionIndex < sections.length; sectionIndex++) {\n    const section = sections[sectionIndex];\n    for (let itemIndex = 0; itemIndex < section.data.length; itemIndex++) {\n      if (i === highlightedIndex) {\n        return {\n          itemIndex,\n          sectionIndex,\n          animated: false,\n        };\n      }\n      i++;\n    }\n  }\n  return {\n    itemIndex: 0,\n    sectionIndex: 0,\n    animated: false,\n  };\n}\n"]}