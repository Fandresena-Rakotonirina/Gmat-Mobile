{"version":3,"sources":["useHighlighted.tsx"],"names":["useHighlighted","inputValue","setInputValue","data","multiple","values","onChangeMultiple","onChangeSingle","inputRef","setVisible","highlightedIndex","setHighlightedIndex","React","useState","highlightedRef","previousData","usePrevious","useEffect","previousItem","current","currentItem","indexOf","exists","before","prev","removeLast","useCallback","filter","_","i","length","pressHighlighted","selectedOption","blur","dataRef","handleKeyPress","e","dataLength","lastIndex","key","nativeEvent","value","ref","useRef","useLayoutEffect"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport type {\n  NativeSyntheticEvent,\n  TextInput as NativeTextInput,\n  TextInputKeyPressEventData,\n} from 'react-native';\nimport useLatest from './useLatest';\nimport type { Dispatch, SetStateAction, MutableRefObject } from 'react';\n\nexport default function useHighlighted<ItemT>({\n  inputValue,\n  setInputValue,\n  data,\n  multiple,\n  values,\n  onChangeMultiple,\n  onChangeSingle,\n\n  inputRef,\n  setVisible,\n}: {\n  values: ItemT[] | null | undefined;\n  inputValue: string;\n  setInputValue: Dispatch<SetStateAction<string>>;\n  data: readonly ItemT[] | null | undefined;\n  multiple: undefined | boolean;\n  onChangeMultiple: (v: ItemT[]) => void;\n  onChangeSingle: (v: ItemT | undefined) => void;\n\n  inputRef: MutableRefObject<NativeTextInput | null>;\n  setVisible: Dispatch<SetStateAction<boolean>>;\n}) {\n  const [highlightedIndex, setHighlightedIndex] = React.useState(0);\n  const highlightedRef = useLatest(highlightedIndex);\n  const previousData = usePrevious(data);\n\n  React.useEffect(() => {\n    if (previousData) {\n      const previousItem = previousData[highlightedRef.current];\n      const currentItem = data?.indexOf(previousItem);\n\n      if (currentItem && currentItem >= 0) {\n        setHighlightedIndex(currentItem);\n        return;\n      }\n    }\n\n    const exists = data?.[highlightedRef.current];\n    if (exists) {\n      return;\n    }\n    const before = data?.[highlightedRef.current - 1];\n    if (before) {\n      setHighlightedIndex((prev) => prev - 1);\n      return;\n    }\n    setHighlightedIndex(0);\n  }, [data, previousData, setHighlightedIndex, highlightedRef]);\n\n  const removeLast = React.useCallback(() => {\n    if (multiple) {\n      onChangeMultiple(\n        (values || []).filter((_, i: number) => i !== (values || []).length - 1)\n      );\n    }\n  }, [multiple, onChangeMultiple, values]);\n\n  const pressHighlighted = React.useCallback(() => {\n    if (multiple) {\n      const selectedOption = data?.[highlightedRef.current];\n      if (selectedOption) {\n        onChangeMultiple([...(values || []), selectedOption]);\n      }\n      setInputValue('');\n    } else {\n      const selectedOption = data?.[highlightedRef.current];\n      onChangeSingle(selectedOption);\n      inputRef.current?.blur();\n      setVisible(false);\n    }\n  }, [\n    data,\n    inputRef,\n    setInputValue,\n    setVisible,\n    highlightedRef,\n    multiple,\n    onChangeMultiple,\n    onChangeSingle,\n    values,\n  ]);\n\n  const dataRef = useLatest(data);\n  const handleKeyPress = React.useCallback(\n    (e: NativeSyntheticEvent<TextInputKeyPressEventData>) => {\n      const dataLength = dataRef.current?.length || 0;\n      const lastIndex = dataLength - 1;\n      const key = e.nativeEvent.key;\n      switch (key) {\n        case 'Backspace':\n          if (inputValue === '') {\n            removeLast();\n          }\n          break;\n        case 'Enter':\n          if (dataLength === 0) {\n            return;\n          }\n          pressHighlighted();\n          break;\n        case 'ArrowDown':\n          if ((dataLength || 0) - 1 >= highlightedRef.current + 1) {\n            setHighlightedIndex((prev) => prev + 1);\n          } else {\n            setHighlightedIndex(0);\n          }\n          break;\n        case 'ArrowUp':\n          if (highlightedRef.current >= 1) {\n            setHighlightedIndex((prev) => prev - 1);\n          } else {\n            setHighlightedIndex(lastIndex);\n          }\n          break;\n        case 'Home':\n          setHighlightedIndex(0);\n          break;\n        case 'End':\n          if (dataLength > 0) {\n            setHighlightedIndex(lastIndex);\n          }\n          break;\n        default:\n      }\n    },\n    [dataRef, highlightedRef, inputValue, pressHighlighted, removeLast]\n  );\n\n  return {\n    handleKeyPress,\n    highlightedIndex,\n  };\n}\n\nfunction usePrevious<T>(\n  value: T\n): React.MutableRefObject<T | undefined>['current'] {\n  const ref = React.useRef<T>();\n  React.useLayoutEffect(() => {\n    ref.current = value;\n  }, [value]);\n  return ref.current;\n}\n"]}